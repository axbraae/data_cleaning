---
title: "Halloween Candy!"
author: "Anne Braae"
categories: [fun, data wrangling, exploratory data analysis, R]
date: "31/07/2021"
# Custom links (optional).
#   Uncomment and edit lines below to show custom links.
links:
 - name: repository
   url: https://github.com/axbraae/data_cleaning/tree/main/halloween_candy
   icon_pack: fab
   icon: github
   
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Candy dataset

This data comes from the [candy hierarchy data](https://www.scq.ubc.ca/so-much-candy-data-seriously/) which was published annually around Halloween from 2014 to 2017. I used the 2015, 2016 and 2017 data sets. The raw data for 2014 is not available and so I did not include it.

The data was generated from an online survey of thousands of people from around the world, assessing their joy, despair or ambivalence to a wide range of Halloween candy and non-candy items.

There are a lot of free text columns and a range of auxiliary non-candy related questions in the survey. The main goal of this project was to gain experience cleaning and wrangling a real world data set. And oh how the halloween candy delivered on this! However this did mean that I didn't have much time to explore and visualise the data. So now I will take a closer look.

## Assumptions

I made a number of assumptions when wrangling the data. Two of the more important are:

* I assumed that there was a data entry issue for the country column in 2016 and 2017. There were numbers entered into the country column where the corresponding age column was empty. I transferred these to the age column.
* I also assumed that the list of candy bars provided by the survey was exhaustive. I know this cannot be the case. I will assume that they include the most popular candy bars from the UK, US and Canada.


# Analysis

### Setup
Load libraries and cleaned data
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(colorspace)
library(showtext)

clean_candy <- read_csv(here::here("clean_data/clean_candy.csv"))
```



```{r}
font_add_google(name = "Amatic SC", family = "amatic-sc")
showtext_auto()
scale <- 4.5 # scale is an adjustment for a 4k screen

# set theme
theme_set(theme_minimal())
theme <- theme(
  text = element_text(family = "amatic-sc", size = 5*scale), 
  plot.title = element_text(size = 7*scale, hjust = 0.5),
  plot.subtitle = element_text(size = 4*scale, hjust = 0.5),
  plot.caption = element_text(size = 3.5*scale),
  legend.text = element_text(size = 2*scale))

theme_2 <- theme(
  text = element_text(family = "amatic-sc", size = 2*scale), 
  plot.title = element_text(size = 7*scale, hjust = 0.5),
  plot.subtitle = element_text(size = 4*scale, hjust = 0.5),
  plot.caption = element_text(size = 3.5*scale),
  legend.text = element_text(size = 2*scale))
```


## Exploratory Data Analysis

```{r}
clean_candy %>% 
  filter(!is.na(joy_induction)) %>%
  mutate(confectionery = if_else(confectionery == TRUE, "Yes", "No")) %>% 
  ggplot() +
  aes(x = confectionery, fill = joy_induction) +
  geom_bar(position = "fill") +
  scale_fill_discrete_qualitative(
    palette = "set 3", nmax = 5, order = c(5, 1, 2)) +
  theme +
  labs(
    title = "Satisfaction gained from edible and inedible candy\n",
    x = "Is it candy you can eat?",
    y = "Proportion of responses\n",
    fill = "Response"
  )
```
<br />
A total of 772352 candy ratings have been given over the three years. This is for all "candy" offered by the survey, including candy which is not a sweet. Although there are more candy items in the survey than none candy items,  


```{r}
clean_candy %>%
  filter(!is.na(going_trick_or_treat)) %>% 
  ggplot() +
  aes(x = age, fill = going_trick_or_treat) +
  geom_histogram(col = "white", bins = 40)  +
  scale_fill_discrete_qualitative(
    palette = "set 3", nmax = 5, order = c(4, 1)) +
  theme +
  labs(
    title = "What is the age range of survey takers?\n",
    x = "Age",
    y = "Total number\n",
    fill = "Going trick or\n treating?"
  )
```

The majority of surveyed individuals were not even going trick or treating! And the average age was overwhelmingly adult between 25 and 50 years old. For those going trick or treating there are two peaks in the age distribution, one around 13 and the other around 35.

### 4. For each of joy, despair and meh, which candy bar revived the most of these ratings?

```{r}
clean_candy %>% 
  filter(confectionery == TRUE,
         #remove missing values from joy rating
         joy_induction != is.na(joy_induction)) %>% 
  group_by(joy_induction, candy) %>% 
  summarise(total_ratings = n()) %>% 
  slice_max(total_ratings)
```
For joy, any full-sized candy bar received the most ratings (7589). For despair, gum from baseball cards received the most ratings (7341) while for meh lollipops received the most ratings (1570).

If we wanted to get a branded bar, filter out "Any full-sized candy bar". 
```{r}
clean_candy %>% 
  filter(confectionery == TRUE,
         joy_induction != is.na(joy_induction),
         candy != "Any full-sized candy bar") %>% 
  group_by(joy_induction, candy) %>% 
  summarise(total_ratings = n()) %>% 
  slice_max(total_ratings)
```

Now we can see that Reeseâ€™s Peanut Butter Cups rate highest for a branded bar (7369).

### 5. How many people rated Starburst as despair?

```{r}
clean_candy %>% 
  filter(candy == "Starburst",
         joy_induction == "DESPAIR") %>% 
  summarise(total_rating = n())
```

A total of 1990 people rated Starburst as despair!


### For the next three questions, count despair as -1, joy as +1 and meh as 0.

Get the data ready for the next three questions.

```{r}
rated_clean_candy <- clean_candy %>% 
  mutate(
    rating = case_when(
      joy_induction == "DESPAIR" ~ as.numeric(-1),
      joy_induction == "JOY" ~ as.numeric(1),
      joy_induction == "MEH" ~ as.numeric(0),
      TRUE ~ NA_real_
    )
  )
```


```{r}

rated_clean_candy %>%
  filter(confectionery == FALSE) %>% 
  group_by(candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  ggplot() +
  aes(x = total_ratings, y = reorder(candy, -total_ratings), fill =(total_ratings>0)) +
  geom_col() +
  scale_fill_discrete_qualitative(
    palette = "set 3", nmax = 5, order = c(1, 3)) +
  theme_2 +
  theme(legend.position = "none") +
  labs(
    title = "What did inedible candy rate?",
    x = "Total ratings",
    y = "Inedible candy\n"
  )
```



```{r}
rated_clean_candy %>% 
  filter(confectionery == TRUE,
         candy != "Any full-sized candy bar") %>% 
  select(gender, candy, rating) %>% 
  group_by(gender, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```
Now it is clear that Reese's Peanut Butter Cups are the preferred candy for all gender groups apart from "Other" who prefer Twix.

### 7. What was the most popular candy bar in each year?

```{r}
rated_clean_candy %>% 
  filter(confectionery == TRUE) %>% 
  select(year, candy, rating) %>%
  group_by(year, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```

For all three years, "Any full-sized candy bar" was the most popular candy. To find the most popular branded bar, I will filter this candy out from the data and rerun it.

```{r}
rated_clean_candy %>% 
  filter(confectionery == TRUE,
         candy != "Any full-sized candy bar") %>% 
  select(year, candy, rating) %>%
  group_by(year, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```

The most popular branded candy bar was Reese's Peanut Butter Cups in 2015 and 2017 and Kit Kat in 2016.

### 8. What was the most popular candy bar by this rating for people in US, Canada, UK and all other countries?

```{r}
rated_clean_candy %>% 
  filter(confectionery == TRUE,
         country != is.na(country)) %>% 
  select(country, candy, rating) %>%
  group_by(country, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```

The UK had a tie for the most popular candy bar, between "Any full-sized candy bar" and "Lindt Truffle" (both with a score of 36). All other countries scored "Any full-sized candy bar" as the best.

Again, to find the best scoring branded bar, filter out this chocolate.

```{r}
rated_clean_candy %>% 
  filter(confectionery == TRUE,
         country != is.na(country),
         candy != "Any full-sized candy bar") %>% 
  select(country, candy, rating) %>%
  group_by(country, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```
Now we can see a clear divide in the countries favourite candy bars. Canada and the rest of the world prefer Kit Kat with a rating of 231 and 58. The UK prefers Lindt Truffle with a score of 36 and the US prefers Reese's Peanut Butter Cups with a score of 1983.


# Other interesting analyses or conclusions

What about M&M's? Let's have a look at what the most popular M&M types are for each country.
```{r}
rated_clean_candy %>% 
  mutate(
    m_n_m = if_else(str_detect(candy, "M&M"), TRUE, FALSE)) %>% 
  filter(confectionery == TRUE,
         country != is.na(country),
         candy != "Any full-sized candy bar",
         m_n_m == TRUE) %>% 
  select(country, candy, rating) %>%
  group_by(country, candy) %>% 
  summarise(total_ratings = sum(rating, na.rm = TRUE)) %>% 
  slice_max(total_ratings)
```

It's a debate between regular and peanut M&M's. Canada and the UK rate regular M&M's the highest with ratings of 172 and 27 respectively. The US and the rest of the world rate Peanut M&M's the highest with ratings of 1645 and 53.

It may be worth revisiting my earlier assumption that spliting the M&M's and the Smarties were fine for this dataset. It would be interesting to see what all M&M's combined score.